/*! qajax 0.1.3 - Simple Promise ajax library based on Q */
!function(a){var b;"object"==typeof exports?(b=require("q"),module.exports=a(b)):"function"==typeof define&&define.amd?define(["q"],a):(b=window.Q,window.Qajax=a(b))}(function(a){"use strict";var b="Content-Type",c=function(){var e,f=arguments;if(!f.length)throw"Qajax: settings are required";if("string"==typeof f[0])e="object"==typeof f[1]&&f[1]||{},e.url=f[0];else{if("object"!=typeof f[0])throw"Qajax: settings must be an object";e=f[0]}if(!e.url)throw"Qajax: settings.url is required";return a.fcall(function(){var f=e.xhr||new XMLHttpRequest,g=e.method||"GET",h=e.url,i=e.data,j=e.timeout||c.TIMEOUT,k=a.defer(),l=e.headers||{},m=(-1===h.indexOf("?")?"?":"&")+"_="+(new Date).getTime();null!==i&&"object"==typeof i&&(b in l||(l[b]="application/json"),i=JSON.stringify(i)),f.onreadystatechange=function(){if(4===f.readyState)try{d(g+" "+h+" => "+f.status),f.status?k.resolve(f):k.reject(f)}catch(a){k.reject(f)}},f.open(g,h+m,!0);for(var n in l)l.hasOwnProperty(n)&&f.setRequestHeader(n,l[n]);return void 0!==i&&null!==i?f.send(i):f.send(),k.promise.timeout(j).fail(function(a){throw a instanceof Error&&(d("Qajax request delay reach in "+g+" "+h),f.abort()),f})})};c.TIMEOUT=6e4,c.filterStatus=function(b){var c,e;if(e=typeof b,"function"===e)c=b;else{if("number"!==e)throw"validStatus type "+e+" unsupported";c=function(a){return a===b}}return function(b){var e=0;try{e=b.status}catch(f){d("Qajax: failed to read xhr.status")}return 1223===e&&(e=204),c(e)?a.resolve(b):a.reject(b)}},c.filterSuccess=c.filterStatus(function(a){return a>=200&&300>a||304===a}),c.toJSON=function(b){return a.fcall(function(){return JSON.parse(b.responseText)})},c.getJSON=function(a){return c({url:a,method:"GET"}).then(c.filterSuccess).then(c.toJSON)},c.serialize=function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(encodeURIComponent(b)+"="+encodeURIComponent(a[b]));return c.join("&")};var d=function(a){window.console&&console.log(a)};return c});