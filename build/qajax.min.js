/*! qajax 0.1.5 - Simple Promise ajax library based on Q */
!function(a){var b;"object"==typeof exports?(b=require("q"),module.exports=a(b)):"function"==typeof define&&define.amd?define(["q"],a):(b=window.Q,window.Qajax=a(b))}(function(a){"use strict";function b(a,b,c){return b=b||{},(void 0===c||null===c)&&(c=f.defaults[a]),a in b?b[a]:c}function c(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(encodeURIComponent(b)+"="+encodeURIComponent(a[b]));return c.join("&")}function d(a){return-1===a.indexOf("?")}var e="Content-Type",f=function(){var h,i=arguments;if(!i.length)throw"Qajax: settings are required";if("string"==typeof i[0])h="object"==typeof i[1]&&i[1]||{},h.url=i[0];else{if("object"!=typeof i[0])throw"Qajax: settings must be an object";h=i[0]}if(!h.url)throw"Qajax: settings.url is required";var j=h.xhr||new XMLHttpRequest,k=b("method",h),l=b("base",h),m=h.url,n=h.data,o=h.params||{},p=a.defer(),q=b("timeout",h,f.TIMEOUT||f.defaults.timeout),r=b("headers",h),s=b("ie",h);s&&(o[s===!0?"_":s]=(new Date).getTime()),l&&(m=l+m);var t=c(o);return t&&(m=m+(d(m)?"?":"&")+t),null!==n&&"object"==typeof n&&(e in r||(r[e]="application/json"),n=JSON.stringify(n)),a.fcall(function(){j.onreadystatechange=function(){if(4===j.readyState)try{g(k+" "+m+" => "+j.status),j.status?p.resolve(j):p.reject(j)}catch(a){p.reject(j)}},j.open(k,m,!0);for(var a in r)r.hasOwnProperty(a)&&j.setRequestHeader(a,r[a]);return void 0!==n&&null!==n?j.send(n):j.send(),q?p.promise.timeout(q).fail(function(a){throw a instanceof Error&&(g("Qajax request delay reach in "+k+" "+m),j.abort()),j}):p.promise})};f.TIMEOUT=void 0,f.defaults={logs:!0,timeout:6e4,ie:!0,method:"GET",headers:{},base:""},f.filterStatus=function(b){var c,d;if(d=typeof b,"function"===d)c=b;else{if("number"!==d)throw"validStatus type "+d+" unsupported";c=function(a){return a===b}}return function(b){var d=0;try{d=b.status}catch(e){g("Qajax: failed to read xhr.status")}return 1223===d&&(d=204),c(d)?a.resolve(b):a.reject(b)}},f.filterSuccess=f.filterStatus(function(a){return a>=200&&300>a||304===a}),f.toJSON=function(b){return a.fcall(function(){return JSON.parse(b.responseText)})},f.getJSON=function(a){return f({url:a,method:"GET"}).then(f.filterSuccess).then(f.toJSON)},f.serialize=c;var g=function(a){f.defaults.logs&&window.console&&console.log(a)};return f});