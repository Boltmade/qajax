/*! qajax 0.1.6 - Simple Promise ajax library based on Q */
!function(a){var b;"object"==typeof exports?(b=require("q"),module.exports=a(b)):"function"==typeof define&&define.amd?define(["q"],a):(b=window.Q,window.Qajax=a(b))}(function(a){"use strict";function b(a,b){return a in b?b[a]:f.defaults[a]}function c(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(encodeURIComponent(b)+"="+encodeURIComponent(a[b]));return c.join("&")}function d(a){return-1===a.indexOf("?")}function e(a){f.defaults.logs&&window.console&&console.log(a)}var f=function(){var f,h=arguments;if(!h.length)throw new Error("Qajax: settings are required");if("string"==typeof h[0])f="object"==typeof h[1]&&h[1]||{},f.url=h[0];else{if("object"!=typeof h[0])throw new Error("Qajax: settings must be an object");f=h[0]}if(!f.url)throw new Error("Qajax: settings.url is required");if("cancellation"in f&&!a.isPromiseAlike(f.cancellation))throw new Error("cancellation must be a Promise.");var i=f.xhr||new XMLHttpRequest,j=f.cancellation||a.defer().promise,k=b("method",f),l=b("base",f),m=f.url,n=f.data,o=f.params||{},p=a.defer(),q=b("timeout",f),r=b("headers",f),s=b("cache",f);s&&(o[s===!0?"_":s]=(new Date).getTime()),l&&(m=l+m);var t=c(o);return t&&(m=m+(d(m)?"?":"&")+t),null!==n&&"object"==typeof n&&(g in r||(r[g]="application/json"),n=JSON.stringify(n)),a.fcall(function(){i.onreadystatechange=function(){if(4===i.readyState)try{e(k+" "+m+" => "+i.status),i.status?p.resolve(i):p.reject(i)}catch(a){p.reject(i)}},i.onprogress=function(a){p.notify(a)},i.open(k,m,!0);for(var a in r)r.hasOwnProperty(a)&&i.setRequestHeader(a,r[a]);return void 0!==n&&null!==n?i.send(n):i.send(),j.fin(function(){p.promise.isFulfilled()||(e("Qajax cancellation reached."),i.abort())}),q?p.promise.timeout(q).fail(function(a){throw a instanceof Error&&(e("Qajax request delay reach in "+k+" "+m),i.abort()),i}):p.promise})};f.TIMEOUT=void 0,f.defaults={logs:!1,timeout:6e4,cache:window.navigator.userAgent.toLowerCase().indexOf("msie")>-1,method:"GET",headers:{},base:""},f.filterStatus=function(b){var c,d;if(d=typeof b,"function"===d)c=b;else{if("number"!==d)throw"validStatus type "+d+" unsupported";c=function(a){return a===b}}return function(b){var d=0;try{d=b.status}catch(f){e("Qajax: failed to read xhr.status")}return 1223===d&&(d=204),c(d)?a.resolve(b):a.reject(b)}},f.filterSuccess=f.filterStatus(function(a){return a>=200&&300>a||304===a}),f.toJSON=function(b){return a.fcall(function(){return JSON.parse(b.responseText)})},f.getJSON=function(a){return f({url:a,method:"GET"}).then(f.filterSuccess).then(f.toJSON)},f.serialize=c;var g="Content-Type";return f});